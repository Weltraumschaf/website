<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="616px" preserveAspectRatio="none" style="width:988px;height:616px;" version="1.1" viewBox="0 0 988 616" width="988px" zoomAndPan="magnify"><defs/><g><rect fill="#F0F0FF" height="585.9219" style="stroke: #FFFFFF; stroke-width: 1.0;" width="524.5" x="450.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="644.75" y="16.0669">Attacker's Session</text><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="67" x2="67" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="67" x2="67" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="67" x2="67" y1="429.0938" y2="555.625"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="327.5" x2="327.5" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="327.5" x2="327.5" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="327.5" x2="327.5" y1="429.0938" y2="555.625"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="412.5" x2="412.5" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="412.5" x2="412.5" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="412.5" x2="412.5" y1="429.0938" y2="555.625"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="489.5" x2="489.5" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="429.0938" y2="555.625"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="757.5" x2="757.5" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="757.5" x2="757.5" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="757.5" x2="757.5" y1="429.0938" y2="555.625"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="939" x2="939" y1="54.4297" y2="388.2891"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="939" x2="939" y1="388.2891" y2="429.0938"/><line style="stroke: #AAAAAA; stroke-width: 1.0;" x1="939" x2="939" y1="429.0938" y2="555.625"/><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="118" x="8" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="15" y="43.1279">User's Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="118" x="8" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="15" y="574.6201">User's Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="285.5" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="292.5" y="43.1279">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="285.5" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="292.5" y="574.6201">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="64" x="380.5" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="387.5" y="43.1279">as.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="64" x="380.5" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="387.5" y="574.6201">as.com</text><rect fill="#F08080" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="454.5" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="461.5" y="43.1279">Attacker</text><rect fill="#F08080" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="454.5" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="461.5" y="574.6201">Attacker</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="715.5" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="722.5" y="43.1279">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="715.5" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="722.5" y="574.6201">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="64" x="907" y="23.1328"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="914" y="43.1279">as.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="64" x="907" y="554.625"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="914" y="574.6201">as.com</text><polygon fill="#375A7F" points="316,81.5625,326,85.5625,316,89.5625,320,85.5625" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="67" x2="322" y1="85.5625" y2="85.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="74" y="80.4966">Use https://as.com</text><polygon fill="#375A7F" points="78,156.0938,68,160.0938,78,164.0938,74,160.0938" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="72" x2="327" y1="160.0938" y2="160.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="84" y="109.6294">Location: https://as.com/auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="116" y="124.7622">?redirect_uri=https://client.com/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="132" y="139.895">&amp;client_id=client_at_as</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="132" y="155.0278">&amp;...</text><polygon fill="#375A7F" points="400.5,185.2266,410.5,189.2266,400.5,193.2266,404.5,189.2266" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="67" x2="406.5" y1="189.2266" y2="189.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="74" y="184.1606">GET https://as.com/auth?...</text><polygon fill="#375A7F" points="78,214.3594,68,218.3594,78,222.3594,74,218.3594" style="stroke: #375A7F; stroke-width: 1.0;"/><polygon fill="#375A7F" points="400.5,214.3594,410.5,218.3594,400.5,222.3594,404.5,218.3594" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="72" x2="406.5" y1="218.3594" y2="218.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="84" y="213.2935">user authentication, authorization</text><polygon fill="#375A7F" points="78,243.4922,68,247.4922,78,251.4922,74,247.4922" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="72" x2="411.5" y1="247.4922" y2="247.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="84" y="242.4263">Redirect to https://client.com/?code=c</text><polygon fill="#375A7F" points="478,272.625,488,276.625,478,280.625,482,276.625" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67" x2="484" y1="276.625" y2="276.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="74" y="271.5591">Code</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="7" x="111" y="271.5591">c</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="122" y="271.5591">leaks to attacker (Referer, etc.)</text><polygon fill="#375A7F" points="746,301.7578,756,305.7578,746,309.7578,750,305.7578" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="490" x2="752" y1="305.7578" y2="305.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="497" y="300.6919">Use https://as.com</text><polygon fill="#375A7F" points="501,376.2891,491,380.2891,501,384.2891,497,380.2891" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="495" x2="757" y1="380.2891" y2="380.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="507" y="329.8247">Location: https://as.com/auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="539" y="344.9575">?redirect_uri=https://client.com/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="555" y="360.0903">&amp;client_id=client_at_as</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="555" y="375.2231">&amp;...</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="365" x="320.5" y="412.4995">The attacker can skip the authentication/authorization at the AS.</text><polygon fill="#375A7F" points="746,446.2266,756,450.2266,746,454.2266,750,450.2266" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="490" x2="752" y1="450.2266" y2="450.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="497" y="445.1606">Redirect to https://client.com/?code=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="7" x="734" y="445.1606">c</text><polygon fill="#375A7F" points="927,475.3594,937,479.3594,927,483.3594,931,479.3594" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="758" x2="933" y1="479.3594" y2="479.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="765" y="474.2935">POST /token?code=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="7" x="892" y="474.2935">c</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="899" y="474.2935">&amp;...</text><polygon fill="#375A7F" points="769,504.4922,759,508.4922,769,512.4922,765,508.4922" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="763" x2="938" y1="508.4922" y2="508.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="775" y="503.4263">access token</text><polygon fill="#375A7F" points="501,533.625,491,537.625,501,541.625,497,537.625" style="stroke: #375A7F; stroke-width: 1.0;"/><polygon fill="#375A7F" points="746,533.625,756,537.625,746,541.625,750,537.625" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="495" x2="752" y1="537.625" y2="537.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="507" y="532.5591">Use access token via the client</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="61" x="915" y="603.2041">danielfett.de</text><!--MD5=[dd1fd86604b481cadbdfc0faa7d75c00]
@startuml
hide stereotype
skinparam shadowing false
skinparam sequence {
ArrowColor #375a7f
LifeLineBorderColor #aaa
BoundaryBackgroundColor #f00

ParticipantBorderColor #375a7f
ParticipantBackgroundColor #375a7f
ParticipantFontColor #fff
ParticipantFontName Roboto
ParticipantFontSize 14

BoxBackgroundColor #f0f0ff
BoxBorderColor transparent
ParticipantBackgroundColor<<Attacker>> #F08080
}

skinparam note {
BackgroundColor #CEE1F5
BorderColor #CEE1F5
FontColor #000

BackgroundColor<<warning>> #FFCEB5
BorderColor<<warning>> #FFCEB5

BackgroundColor<<ok>> #C6EAA6
BorderColor<<ok>> #C6EAA6
}

right footer danielfett.de

participant "User's Browser" as Browser
participant client.com
participant as.com

box Attacker's Session
participant Attacker <<Attacker>>
participant client.com as client.com2
participant as.com as as.com2
endbox

Browser -> client.com: Use https://as.com
client.com -> Browser: Location: https://as.com/auth\n        ?redirect_uri=https://client.com/\n            &client_id=client_at_as\n            &...

Browser -> as.com: GET https://as.com/auth?...
Browser <- -> as.com: user authentication, authorization
as.com -> Browser: Redirect to https://client.com/?code=c
Browser - -> Attacker: Code <font color=red><i>c</i></font> leaks to attacker (Referer, etc.)

Attacker -> client.com2: Use https://as.com
client.com2 -> Attacker: Location: https://as.com/auth\n        ?redirect_uri=https://client.com/\n            &client_id=client_at_as\n            &...

... The attacker can skip the authentication/authorization at the AS. ...
Attacker -> client.com2: Redirect to https://client.com/?code=<font color=red><i>c</i></font>
client.com2 -> as.com2: POST /token?code=<font color=red><i>c</i></font>&...
as.com2 -> client.com2: access token
Attacker <- -> client.com2: Use access token via the client
@enduml

PlantUML version 1.2020.08(Sun Apr 26 14:08:22 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_252-b09
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
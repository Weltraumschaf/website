<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="543px" preserveAspectRatio="none" style="width:759px;height:543px;" version="1.1" viewBox="0 0 759 543" width="759px" zoomAndPan="magnify"><defs/><g><line style="stroke: #CCCCCC; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="43" x2="43" y1="34.2969" y2="502.9531"/><line style="stroke: #CCCCCC; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="329" x2="329" y1="34.2969" y2="502.9531"/><line style="stroke: #CCCCCC; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="589.5" x2="589.5" y1="34.2969" y2="502.9531"/><line style="stroke: #CCCCCC; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="699.5" x2="699.5" y1="34.2969" y2="502.9531"/><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="8" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="15" y="22.9951">Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="8" y="501.9531"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="15" y="521.9482">Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="287" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="294" y="22.9951">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="287" y="501.9531"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="294" y="521.9482">client.com</text><rect fill="#C3744B" height="30.2969" style="stroke: #C3744B; stroke-width: 1.5;" width="104" x="537.5" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="544.5" y="22.9951">attacker.com</text><rect fill="#C3744B" height="30.2969" style="stroke: #C3744B; stroke-width: 1.5;" width="104" x="537.5" y="501.9531"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="544.5" y="521.9482">attacker.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="97" x="651.5" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="658.5" y="22.9951">honest.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="97" x="651.5" y="501.9531"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="658.5" y="521.9482">honest.com</text><polygon fill="#375A7F" points="317.5,61.4297,327.5,65.4297,317.5,69.4297,321.5,65.4297" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="323.5" y1="65.4297" y2="65.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="50.5" y="60.3638">Use https://attacker.com</text><polygon fill="#375A7F" points="54.5,166.2266,44.5,170.2266,54.5,174.2266,50.5,170.2266" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="328.5" y1="170.2266" y2="170.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="60.5" y="89.4966">Location: https://attacker.com/auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="92.5" y="104.6294">?redirect_uri=https://client.com/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="108.5" y="119.7622">&amp;client_id=client_at_attacker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="108.5" y="134.895">&amp;code_challenge=sha256(n)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="108.5" y="150.0278">&amp;state=s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="108.5" y="165.1606">&amp;...</text><path d="M334,113.2617 L334,138.2617 L597,138.2617 L597,123.2617 L587,113.2617 L334,113.2617 " fill="#CEE1F5" style="stroke: #CEE1F5; stroke-width: 1.0;"/><path d="M587,113.2617 L587,123.2617 L597,123.2617 L587,113.2617 " fill="#CEE1F5" style="stroke: #CEE1F5; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="340" y="130.3286">stored: AS to be used is attacker.com</text><polygon fill="#375A7F" points="577.5,195.3594,587.5,199.3594,577.5,203.3594,581.5,199.3594" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="583.5" y1="199.3594" y2="199.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="50.5" y="194.2935">GET https://attacker.com/auth?...</text><polygon fill="#375A7F" points="54.5,285.0234,44.5,289.0234,54.5,293.0234,50.5,289.0234" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="588.5" y1="289.0234" y2="289.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="421" x="60.5" y="223.4263">Location: https://honest.com/auth?redirect_uri=https://client.com/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="108.5" y="238.5591">&amp;client_id=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="182.5" y="238.5591">client_at_honest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="108.5" y="253.6919">&amp;code_challenge=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="229.5" y="253.6919">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="108.5" y="268.8247">&amp;state=s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="108.5" y="283.9575">&amp;...</text><polygon fill="#375A7F" points="688,314.1563,698,318.1563,688,322.1563,692,318.1563" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="694" y1="318.1563" y2="318.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="50.5" y="313.0903">GET https://honest.com/auth?....</text><polygon fill="#375A7F" points="54.5,343.2891,44.5,347.2891,54.5,351.2891,50.5,347.2891" style="stroke: #375A7F; stroke-width: 1.0;"/><polygon fill="#375A7F" points="688,343.2891,698,347.2891,688,351.2891,692,347.2891" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="48.5" x2="694" y1="347.2891" y2="347.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="60.5" y="342.2231">user authentication, authorization</text><polygon fill="#375A7F" points="54.5,372.4219,44.5,376.4219,54.5,380.4219,50.5,376.4219" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="699" y1="376.4219" y2="376.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="60.5" y="371.356">Redirect to https://client.com/?code=c&amp;state=s</text><polygon fill="#375A7F" points="317.5,401.5547,327.5,405.5547,317.5,409.5547,321.5,405.5547" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="323.5" y1="405.5547" y2="405.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="50.5" y="400.4888">GET https://client.com/?code=c&amp;state=s</text><polygon fill="#375A7F" points="577.5,445.8203,587.5,449.8203,577.5,453.8203,581.5,449.8203" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="329.5" x2="583.5" y1="449.8203" y2="449.8203"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="336.5" y="429.6216">GET /token?code_verifier=n&amp;code=c</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="352.5" y="444.7544"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="352.5" y="444.7544">&amp;state=s&amp;redirect_uri=...</text><path d="M594,462.8203 L594,487.8203 L726,487.8203 L726,472.8203 L716,462.8203 L594,462.8203 " fill="#FFCEB5" style="stroke: #FFCEB5; stroke-width: 1.0;"/><path d="M716,462.8203 L716,472.8203 L726,472.8203 L716,462.8203 " fill="#FFCEB5" style="stroke: #FFCEB5; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="600" y="479.8872">Attack successful</text><!--MD5=[20e4fed6490476b028b1232dbd524111]
@startuml
hide stereotype
skinparam shadowing false
skinparam sequence {
ArrowColor #375a7f
LifeLineBorderColor #ccc

ParticipantBorderColor #375a7f
ParticipantBackgroundColor #375a7f
ParticipantFontColor #fff
ParticipantFontName Roboto
ParticipantFontSize 14

ParticipantBorderColor<<Attacker>> #C3744B
ParticipantBackgroundColor<<Attacker>> #C3744B
}

skinparam note {
BackgroundColor #CEE1F5
BorderColor #CEE1F5
FontColor #000

BackgroundColor<<warning>> #FFCEB5
BorderColor<<warning>> #FFCEB5

BackgroundColor<<ok>> #C6EAA6
BorderColor<<ok>> #C6EAA6
}

participant Browser
participant client.com
participant attacker.com <<Attacker>>
participant honest.com

Browser -> client.com: Use https://attacker.com
client.com -> Browser: Location: https://attacker.com/auth\n        ?redirect_uri=https://client.com/\n            &client_id=client_at_attacker\n            &code_challenge=sha256(n)\n            &state=s\n            &...
note right: stored: AS to be used is attacker.com

Browser -> attacker.com: GET https://attacker.com/auth?...
attacker.com -> Browser: Location: https:~//honest.com/auth?redirect_uri=https://client.com/\n            &client_id=<font color=red>client_at_honest\n            &code_challenge=<font color=red>k</font>\n            &state=s\n            &...
Browser -> honest.com: GET https:~//honest.com/auth?....
Browser <- -> honest.com: user authentication, authorization
honest.com -> Browser: Redirect to https://client.com/?code=c&state=s
Browser -> client.com: GET https://client.com/?code=c&state=s
client.com -> attacker.com: <font color=red>GET /token?code_verifier=n&code=c\n    <font color=red>&state=s&redirect_uri=...

note<<warning>> right attacker.com 
    Attack successful
end note
@enduml

PlantUML version 1.2020.08(Sun Apr 26 14:08:22 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_252-b09
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="537px" preserveAspectRatio="none" style="width:820px;height:537px;" version="1.1" viewBox="0 0 820 537" width="820px" zoomAndPan="magnify"><defs/><g><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="43" x2="43" y1="34.2969" y2="480.8203"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="424" x2="424" y1="34.2969" y2="480.8203"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="644.5" x2="644.5" y1="34.2969" y2="480.8203"/><line style="stroke: #AAAAAA; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="754.5" x2="754.5" y1="34.2969" y2="480.8203"/><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="8" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="15" y="22.9951">Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="71" x="8" y="479.8203"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="15" y="499.8154">Browser</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="382" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="389" y="22.9951">client.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="85" x="382" y="479.8203"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="389" y="499.8154">client.com</text><rect fill="#F08080" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="104" x="592.5" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="599.5" y="22.9951">attacker.com</text><rect fill="#F08080" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="104" x="592.5" y="479.8203"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="599.5" y="499.8154">attacker.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="97" x="706.5" y="3"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="713.5" y="22.9951">honest.com</text><rect fill="#375A7F" height="30.2969" style="stroke: #375A7F; stroke-width: 1.5;" width="97" x="706.5" y="479.8203"/><text fill="#FFFFFF" font-family="Roboto" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="713.5" y="499.8154">honest.com</text><polygon fill="#375A7F" points="412.5,61.4297,422.5,65.4297,412.5,69.4297,416.5,65.4297" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="418.5" y1="65.4297" y2="65.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="50.5" y="60.3638">Use https://attacker.com</text><polygon fill="#375A7F" points="54.5,166.2266,44.5,170.2266,54.5,174.2266,50.5,170.2266" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="423.5" y1="170.2266" y2="170.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="60.5" y="89.4966">Location: https://attacker.com/auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="92.5" y="104.6294">?redirect_uri=https://client.com/</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="297.5" y="104.6294">as/attacker.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="108.5" y="119.7622">&amp;client_id=client_at_attacker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="108.5" y="134.895">&amp;code_challenge=sha256(n)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="108.5" y="150.0278">&amp;state=s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="108.5" y="165.1606">&amp;...</text><path d="M429,113.2617 L429,138.2617 L620,138.2617 L620,123.2617 L610,113.2617 L429,113.2617 " fill="#CEE1F5" style="stroke: #CEE1F5; stroke-width: 1.0;"/><path d="M610,113.2617 L610,123.2617 L620,123.2617 L610,113.2617 " fill="#CEE1F5" style="stroke: #CEE1F5; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="435" y="130.3286">stored: AS is attacker.com</text><polygon fill="#375A7F" points="632.5,195.3594,642.5,199.3594,632.5,203.3594,636.5,199.3594" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="638.5" y1="199.3594" y2="199.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="50.5" y="194.2935">GET https://attacker.com/auth?...</text><polygon fill="#375A7F" points="54.5,285.0234,44.5,289.0234,54.5,293.0234,50.5,289.0234" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="643.5" y1="289.0234" y2="289.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="421" x="60.5" y="223.4263">Location: https://honest.com/auth?redirect_uri=https://client.com/</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="481.5" y="223.4263">as/honest.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="108.5" y="238.5591">&amp;client_id=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="182.5" y="238.5591">client_at_honest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="108.5" y="253.6919">&amp;code_challenge=</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="229.5" y="253.6919">k</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="108.5" y="268.8247">&amp;state=s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="108.5" y="283.9575">&amp;...</text><polygon fill="#375A7F" points="743,314.1563,753,318.1563,743,322.1563,747,318.1563" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="749" y1="318.1563" y2="318.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="50.5" y="313.0903">GET https://honest.com/auth?....</text><polygon fill="#375A7F" points="54.5,343.2891,44.5,347.2891,54.5,351.2891,50.5,347.2891" style="stroke: #375A7F; stroke-width: 1.0;"/><polygon fill="#375A7F" points="743,343.2891,753,347.2891,743,351.2891,747,347.2891" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="48.5" x2="749" y1="347.2891" y2="347.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="60.5" y="342.2231">user authentication, authorization</text><polygon fill="#375A7F" points="54.5,372.4219,44.5,376.4219,54.5,380.4219,50.5,376.4219" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="48.5" x2="754" y1="376.4219" y2="376.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="60.5" y="371.356">Redirect to https://client.com/</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="248.5" y="371.356">as/honest.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="343.5" y="371.356">?code=c&amp;state=s</text><polygon fill="#375A7F" points="412.5,401.5547,422.5,405.5547,412.5,409.5547,416.5,405.5547" style="stroke: #375A7F; stroke-width: 1.0;"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="43.5" x2="418.5" y1="405.5547" y2="405.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="50.5" y="400.4888">GET https://client.com/</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="194.5" y="400.4888">as/honest.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="289.5" y="400.4888">?code=c&amp;state=s</text><line style="stroke: #375A7F; stroke-width: 1.0;" x1="424.5" x2="466.5" y1="449.8203" y2="449.8203"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="466.5" x2="466.5" y1="449.8203" y2="462.8203"/><line style="stroke: #375A7F; stroke-width: 1.0;" x1="425.5" x2="466.5" y1="462.8203" y2="462.8203"/><polygon fill="#375A7F" points="435.5,458.8203,425.5,462.8203,435.5,466.8203,431.5,462.8203" style="stroke: #375A7F; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="431.5" y="429.6216">issuer encoded in redirect URI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="447.5" y="444.7544"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="447.5" y="444.7544">does not match attacker.com</text><path d="M649,429.6211 L649,454.6211 L767,454.6211 L767,439.6211 L757,429.6211 L649,429.6211 " fill="#C6EAA6" style="stroke: #C6EAA6; stroke-width: 1.0;"/><path d="M757,429.6211 L757,439.6211 L767,439.6211 L757,429.6211 " fill="#C6EAA6" style="stroke: #C6EAA6; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="655" y="446.688">Attack stopped</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="61" x="747.5" y="524.3994">danielfett.de</text><!--MD5=[7660fed4d447a4bc35d4ec631c1abe2a]
@startuml
hide stereotype
skinparam shadowing false
skinparam sequence {
ArrowColor #375a7f
LifeLineBorderColor #aaa
BoundaryBackgroundColor #f00

ParticipantBorderColor #375a7f
ParticipantBackgroundColor #375a7f
ParticipantFontColor #fff
ParticipantFontName Roboto
ParticipantFontSize 14

BoxBackgroundColor #f0f0ff
BoxBorderColor transparent
ParticipantBackgroundColor<<Attacker>> #F08080
}

skinparam note {
BackgroundColor #CEE1F5
BorderColor #CEE1F5
FontColor #000

BackgroundColor<<warning>> #FFCEB5
BorderColor<<warning>> #FFCEB5

BackgroundColor<<ok>> #C6EAA6
BorderColor<<ok>> #C6EAA6
}

right footer danielfett.de

participant Browser
participant client.com
participant attacker.com <<Attacker>>
participant honest.com

Browser -> client.com: Use https://attacker.com
client.com -> Browser: Location: https://attacker.com/auth\n        ?redirect_uri=https://client.com/<font color=blue>as/attacker.com</font>\n            &client_id=client_at_attacker\n            &code_challenge=sha256(n)\n            &state=s\n            &...
note right: stored: AS is attacker.com

Browser -> attacker.com: GET https://attacker.com/auth?...
attacker.com -> Browser: Location: https:~//honest.com/auth?redirect_uri=https://client.com/<font color=blue>as/honest.com</font>\n            &client_id=<font color=red>client_at_honest\n            &code_challenge=<font color=red>k</font>\n            &state=s\n            &...
Browser -> honest.com: GET https:~//honest.com/auth?....
Browser <- -> honest.com: user authentication, authorization
honest.com -> Browser: Redirect to https://client.com/<font color=blue>as/honest.com</font>?code=c&state=s
Browser -> client.com: GET https://client.com/<font color=blue>as/honest.com</font>?code=c&state=s
client.com -> client.com: <font color=red>issuer encoded in redirect URI\n    <font color=red>does not match attacker.com
note<<ok>> right
    Attack stopped
end note
@enduml

PlantUML version 1.2020.08(Sun Apr 26 14:08:22 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_252-b09
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>